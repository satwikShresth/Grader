<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/static/center.css">
    <title>Assignment Grades</title>
</head>
<body>
    {% include 'navbar.html' %}  <!-- Navbar component -->

    <h1>Assignment {{ assignment_number }} Grades</h1>

    <!-- Group tabs above student cards, aligned to the right -->
    <div class="group-tabs-container">

        <button class="compile-assignments-btn" onclick="compileAssignments()">Compile Assignments</button>

        <div class="group-tabs">
            Group
            {% for group in groups %}
            <button class="group-tab" data-group="{{ group }}" onclick="toggleGroup('{{ group }}')">
                {{ group }}
            </button>
            {% endfor %}
        </div>
    </div>

    <!-- Loop through students and show only those who have submitted -->
    {% for student in students %}
        {% if student.submission_date %}
        <!-- Make the whole card clickable, leading to the form -->
        <a href="/grade/assignment/{{ assignment_number }}/{{ student.UserID }}">
            <div class="student-card" data-group="{{ student.group }}">
                <table>
                    <tr>
                        <th>User ID:</th>
                        <td>{{ student.UserID }}</td>
                    </tr>
                    <tr>
                        <th>Name:</th>
                        <td>{{ student.Name }}</td>
                    </tr>
                    <tr>
                        <th>Submission Date:</th>
                        <td>{{ student.submission_date }}</td>
                    </tr>
                    <tr>
                        <th>Grade:</th>
                        <td>{% if student.grade %}{{ student.grade }}{% else %}---{% endif %}</td>
                    </tr>
                </table>
            </div>
        </a>
        {% endif %}
    {% endfor %}

    <script>
        // Function to call the compile assignments API
        function compileAssignments() {
            fetch(`/grade/assignment/process-submissions?assignment_number={{ assignment_number }}`, {
                method: 'POST'
            })
            .then(response => {
                if (response.ok) {
                    alert('Assignments compiled successfully.');
                } else {
                    alert('Error compiling assignments.');
                }
            })
            .catch(error => {
                console.error('Error:', error);
                alert('Error compiling assignments.');
            });
        }

        function toggleGroup(group) {
            const groupCards = document.querySelectorAll(`.student-card[data-group="${group}"]`);
            const groupButton = document.querySelector(`button[data-group="${group}"]`);

            // Toggle visibility of each student's card for the group
            groupCards.forEach(card => {
                if (card.classList.contains('hidden')) {
                    card.classList.remove('hidden');
                } else {
                    card.classList.add('hidden');
                }
            });



            // Toggle active/inactive state of the button
            groupButton.classList.toggle('inactive');
        }
    </script>
</body>
</html>
