<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ title }}</title>
    <link rel="stylesheet" href="/static/homepage.css">
    <link rel="stylesheet" href="/static/nav.css">
</head>
<body>

    <!-- Main Container -->
    <div class="container">

        <!-- Navbar -->
        <div class="navbar">
            <a href="/">Home Page</a>
            <a href="/grade/assignment">Grade Center</a>
        </div>

        <!-- Title -->
        <h1>{{ title }}</h1>

        <!-- Form to collect additional details -->
        <div class="form-section">
            <label for="assignmentName">Assignment Name</label>
            <input type="text" id="assignmentName" name="assignmentName" placeholder="Enter Assignment Name" required>
        </div>

        <div class="form-section">
            <label for="assignmentId">Assignment ID</label>
            <input type="number" id="assignmentId" name="assignmentId" placeholder="Enter Assignment ID" required min="1">
        </div>

        <div class="form-section">
            <label for="dueDate">Due Date</label>
            <input type="date" id="dueDate" name="dueDate" required>
        </div>

        <!-- Rubric Upload Section -->
        <div class="drop-area" id="rubric-drop-area" >
            <p style="color: white;">Drag and drop a Rubric (.json) file here or click to select one.</p>
            <input type="file" name="rubricFile" id="rubricElem" accept=".json" required class="hidden">
            <button type="button" class="choose-file-btn rounded-btn" onclick="document.getElementById('rubricElem').click()">Choose Rubric File</button>
        </div>

        <!-- Gradebook Upload Section -->
        <div class="drop-area" id="gradebook-drop-area" style="text-align: center;">
            <p style="color: white;">Drag and drop a .zip file here or click to select one.</p>
            <input type="file" name="gradebookFile" id="gradebookElem" accept=".zip" required class="hidden">
            <button type="button" class="choose-file-btn rounded-btn" onclick="document.getElementById('gradebookElem').click()">Choose Gradebook File</button>
        </div>

        <!-- Submit Button (Initially disabled) -->
        <button type="button" id="submitBtn" class="submit-btn" onclick="uploadAll()" disabled>Upload All</button>

    </div>

    <script>
        function checkFormCompletion() {
            const assignmentName = document.getElementById('assignmentName').value;
            const assignmentId = document.getElementById('assignmentId').value;
            const dueDate = document.getElementById('dueDate').value;
            const rubricFile = document.getElementById('rubricElem').files.length > 0;
            const gradebookFile = document.getElementById('gradebookElem').files.length > 0;

            const submitBtn = document.getElementById('submitBtn');

            if (assignmentName && assignmentId && dueDate && rubricFile && gradebookFile) {
                submitBtn.disabled = false;
            } else {
                submitBtn.disabled = true;
            }
        }

        // Event listeners for form inputs
        document.getElementById('assignmentName').addEventListener('input', checkFormCompletion);
        document.getElementById('assignmentId').addEventListener('input', checkFormCompletion);
        document.getElementById('dueDate').addEventListener('input', checkFormCompletion);
        document.getElementById('rubricElem').addEventListener('change', checkFormCompletion);
        document.getElementById('gradebookElem').addEventListener('change', checkFormCompletion);

        function handleRubricFileSelection(files) {
            let dropArea = document.getElementById('rubric-drop-area');

            if (files.length === 0) {
                alert("Please select a .json file.");
                dropArea.classList.remove('highlight');
                return;
            }

            let file = files[0];
            if (file.name.toLowerCase().endsWith('.json')) {
                dropArea.classList.add('highlight');
            } else {
                alert("Invalid file type. Please upload a .json file.");
                dropArea.classList.remove('highlight');
                document.getElementById('rubricElem').value = '';
            }
            checkFormCompletion();
        }

        function handleGradebookFileSelection(files) {
            let dropArea = document.getElementById('gradebook-drop-area');

            if (files.length === 0) {
                alert("Please select a .zip file.");
                dropArea.classList.remove('highlight');
                return;
            }

            let file = files[0];
            if (file.name.toLowerCase().endsWith('.zip')) {
                dropArea.classList.add('highlight');
            } else {
                alert("Invalid file type. Please upload a .zip file.");
                dropArea.classList.remove('highlight');
                document.getElementById('gradebookElem').value = '';
            }
            checkFormCompletion();
        }

        // Initialize each drop area with its own handlers
        function initDropArea(dropAreaId, fileInputId, handleFileSelection) {
            let dropArea = document.getElementById(dropAreaId);
            let fileInput = document.getElementById(fileInputId);

            fileInput.addEventListener('change', (event) => {
                handleFileSelection(event.target.files);
            });

            function addHighlight(e) {
                e.preventDefault();
                e.stopPropagation();
                dropArea.classList.add('highlight');
            }

            function removeHighlight(e) {
                e.preventDefault();
                e.stopPropagation();
                dropArea.classList.remove('highlight');
            }

            function handleDrop(e) {
                e.preventDefault();
                e.stopPropagation();
                removeHighlight(e);

                let files = e.dataTransfer.files;
                if (files.length) {
                    fileInput.files = files;
                    handleFileSelection(files);
                }
            }

            // Assign drag-and-drop events for the drop area
            dropArea.addEventListener('dragenter', addHighlight);
            dropArea.addEventListener('dragover', addHighlight);
            dropArea.addEventListener('dragleave', removeHighlight);
            dropArea.addEventListener('drop', handleDrop);
        }

        // Initialize drop areas
        initDropArea('rubric-drop-area', 'rubricElem', handleRubricFileSelection);
        initDropArea('gradebook-drop-area', 'gradebookElem', handleGradebookFileSelection);

        // Upload all data
        function uploadAll() {
            const assignmentName = document.getElementById('assignmentName').value;
            const assignmentId = document.getElementById('assignmentId').value;
            const dueDate = document.getElementById('dueDate').value;
            const rubricFile = document.getElementById('rubricElem').files[0];
            const gradebookFile = document.getElementById('gradebookElem').files[0];

            let formData = new FormData();
            formData.append('assignmentName', assignmentName);
            formData.append('assignmentId', assignmentId);
            formData.append('dueDate', dueDate);
            formData.append('rubricFile', rubricFile);
            formData.append('gradebookFile', gradebookFile);

            fetch('/upload/all/', {
                method: 'POST',
                body: formData
            }).then(response => response.json())
              .then(result => {
                  alert(result.message);
              }).catch(error => {
                  alert('Error uploading data: ' + error);
              });
        }
    </script>
</body>
</html>

